// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3.0
(()=>{var $=(E,m,l)=>new Promise((w,f)=>{var h=y=>{try{d(l.next(y))}catch(i){f(i)}},c=y=>{try{d(l.throw(y))}catch(i){f(i)}},d=y=>y.done?w(y.value):Promise.resolve(y.value).then(h,c);d((l=l.apply(E,m)).next())});var pe=["audio","images","software","texts","video","web","more"],Z=location.hostname==="localhost"||location.host.substr(0,4)==="www-"||location.host.substr(0,4)==="cat-"||location.host.substr(0,11)==="ia-petabox-"?console.log.bind(console):()=>{};document.addEventListener("DOMContentLoaded",()=>{let E=document.querySelector("ia-topnav");if(!E)return;let m=document.querySelector("ia-topnav primary-nav"),l=document.querySelector("ia-topnav search-menu .search-menu-inner"),w=m.querySelector("nav-search"),f=m.querySelector("media-menu"),h=document.querySelector("ia-topnav media-slider"),c=document.querySelector("ia-topnav user-menu"),d=document.querySelector("ia-topnav .user-info"),y=document.querySelector("login-button button.login-button"),i=document.querySelector("signed-out-dropdown nav"),D=f.querySelector(".media-menu-container"),W=E.querySelector("desktop-subnav"),N=document.querySelector("ia-topnav wayback-search form"),p="usermenu",r=[],b=0,A=null,k=null,U=null,T=!1,_=!1;function R(e){Z("<ia-topnav>:",e)}function F({event:e}){if(!window.archive_analytics)return;let[t,o]=e.split("|");window.archive_analytics.send_event_no_sampling(t,o,window.location.pathname)}function q(){document.querySelector("#close-layer").classList.add("visible")}function Q(){w.querySelector(".search-activated").classList.add("search-inactive"),w.querySelector(".search-activated").classList.remove("flex")}function S(){Q(),l.classList.add("closed"),l.setAttribute("aria-hidden","true"),l.setAttribute("aria-expanded","false"),P(!0)}function g(e=!0){f.querySelectorAll("media-button a.selected").forEach(t=>{_&&t.focus(),t.classList.remove("selected")}),h.querySelectorAll(".open").forEach(t=>t.classList.remove("open")),e&&(D.classList.remove("open"),z()),_=!1,X("hidden")}function X(e=""){let t=h.querySelector(".information-menu");t.style.visibility=e}function j(e=""){let t=e!=="hidden",o=c.querySelector("nav");o.setAttribute("aria-hidden",!t),o.setAttribute("aria-expanded",t),c.style.visibility=e}function P(e=!1){let t=l.querySelectorAll('input[type="radio"]');for(let o of t)o.disabled=e}function v(e,t){if(!e)return;(e instanceof Element?[e]:Array.from(e)).forEach(n=>{Object.entries(t).forEach(([a,s])=>{n.setAttribute(a,s)})})}function L(){if(i==null||i.classList.add("initial"),i==null||i.classList.remove("open"),v(i,{"aria-hidden":"true"}),v(i==null?void 0:i.querySelectorAll("li a"),{tabindex:"-1"}),v(document.querySelector("signed-out-dropdown"),{tabindex:"-1"}),!c)return;let e=c.querySelector("nav");e.classList.contains("open")&&(j("hidden"),T?d.querySelector("button.user-menu").focus():d.querySelector("button.user-menu").blur()),v(c.querySelectorAll("a"),{tabindex:"-1"}),e.classList.add("initial"),e.classList.remove("open"),T=!1}function K(){g(),L(),l.classList.remove("closed"),l.setAttribute("aria-hidden",!1),l.setAttribute("aria-expanded",!0),P(!1),q()}function Y(){w.querySelector(".search-activated").classList.remove("search-inactive"),w.querySelector(".search-activated").classList.add("flex"),q()}function J(){if(i==null||i.classList.add("open"),i==null||i.classList.remove("initial"),i==null||i.querySelector("li a").focus(),v(i,{"aria-hidden":"false"}),v(i==null?void 0:i.querySelectorAll("li a"),{tabindex:""}),v(document.querySelector("signed-out-dropdown"),{tabindex:""}),!c)return;let e=c.querySelector("nav");e.classList.add("open"),e.classList.remove("initial"),v(e,{"aria-hidden":!1,"aria-expanded":!0}),v(c.querySelectorAll("a"),{tabindex:""}),q(),j()}function ee(e){S(),g(!1),L(),X(),h.querySelectorAll(".closed").forEach(t=>t.classList.toggle("open")),h.querySelectorAll("media-subnav").forEach(t=>t.classList.add("hidden")),h.querySelector(`media-subnav[menu=${e}]`).classList.remove("hidden"),q()}function te(){var e,t,o;R("adding tracking event listeners"),E.addEventListener("trackClick",({detail:n})=>{F(n),R(`Analytics click fired: ${n.event}`)}),E.addEventListener("trackSubmit",({detail:n})=>{F(n),R(`Analytics submit fired: ${n.event}`)}),window.addEventListener("pageshow",n=>{n.persisted&&window.location.reload()}),w.querySelector("input[type=text]").addEventListener("focus",K),l.querySelector("a.advanced-search").addEventListener("focus",K),(e=d==null?void 0:d.querySelector("button.dropdown-toggle"))==null||e.addEventListener("click",n=>$(this,null,function*(){let a=n.currentTarget;i.classList.contains("open")?(L(),a.setAttribute("aria-expanded","false")):(g(),S(),J(),q(),a.setAttribute("aria-expanded","true")),p="signedOutMenu",r=yield C(i),setTimeout(()=>{r[0].focus()},100)})),(t=d==null?void 0:d.querySelector("button.user-menu"))==null||t.addEventListener("click",()=>$(this,null,function*(){p="usermenu",r=yield C(c),setTimeout(()=>{r[1].focus()},100)})),(o=m.querySelector(".user-menu"))==null||o.addEventListener("click",()=>{c.querySelector("nav").classList.contains("open")?L():(g(),S(),J(),q())});for(let n of pe){let a=f.querySelector(`media-button[data-mediatype=${n}] a`);a.addEventListener("click",s=>$(this,null,function*(){a.classList.contains("selected")?g(!1):(ee(n),a.classList.add("selected"),D.classList.add("open"),V()),p="mediamenu";let u=h.querySelector(`media-subnav[menu=${n}]:not(.hidden)`);return r=yield C(u),setTimeout(()=>{r[0].focus()},100),s&&s.preventDefault&&s.preventDefault(),s&&s.stopPropagation&&s.stopPropagation(),!1}))}document.querySelector("#close-layer").addEventListener("click",()=>{g(),S(),L(),document.querySelector("#close-layer").classList.remove("visible")}),N.addEventListener("submit",n=>{n.preventDefault();let x=`https://web.archive.org/web/*/${new FormData(N).get("url")}`;window.location.href=x}),m.querySelector("button.hamburger").addEventListener("click",()=>{S(),L(),D.classList.contains("open")?(g(),z()):(D.classList.add("open"),q(),V())}),m.querySelector(".search-trigger").addEventListener("click",()=>{Y(),K()}),m.querySelector("a.upload").addEventListener("focus",()=>S()),W.querySelector("a.desktop-subnav").addEventListener("focus",()=>S())}let B=e=>{console.log("Keydown detected:",e.key),oe(e)};function C(e){return $(this,null,function*(){ne(e);let o=e.querySelectorAll("a, input, select, button");return r=o,b=0,p==="mediamenu"&&(A||(A=B,e.addEventListener("keydown",A))),p==="usermenu"&&(k||(k=B,e.addEventListener("keydown",k))),p==="signedOutMenu"&&(U||(U=B,e.addEventListener("keydown",U))),Array.from(o).filter(n=>!n.hasAttribute("disabled"))})}function ne(e){A&&(e.removeEventListener("keydown",A),A=null),k&&(e.removeEventListener("keydown",k),k=null)}function oe(e){let{key:t}=e;["ArrowDown","ArrowRight","ArrowUp","ArrowLeft"].includes(t)?(ie(t),e.preventDefault()):t==="Tab"?(se(e),e.preventDefault()):t==="Escape"&&(le(e),e.preventDefault())}function ie(e){["ArrowDown","ArrowRight"].includes(e)?ae():re()}function re(){var e;r.length!==0&&(b=(b-1+r.length)%r.length,(e=r[b])==null||e.focus())}function ae(){var e;r.length!==0&&(b=(b+1)%r.length,(e=r[b])==null||e.focus())}function se(e){var o,n,a,s,x;let t=e.shiftKey;if(p==="usermenu"&&c.querySelector(".user-menu.open")!==null){let u=t?f.querySelector("media-button[data-mediatype=images] a"):document.querySelector("a.upload");u&&u.focus()}if(p==="mediamenu"){(o=r[b])==null||o.blur();let u=["web","texts","video","audio","software","images"],M=-1;u.forEach((fe,ye)=>{f.querySelector(`media-button a.${fe}.selected`)&&(M=ye)});let me=t?M-1:M+1,G=u[me%u.length];t&&M===5?(n=f.querySelector(`media-button a.${G}`))==null||n.focus():M===5?document.querySelector(".user-menu")?(a=document.querySelector(".user-menu"))==null||a.focus():(s=d.querySelector("button.dropdown-toggle"))==null||s.focus():M!==-1&&((x=f.querySelector(`media-button a.${G}`))==null||x.focus())}if(p==="signedOutMenu"){let u=null;y?u=document.querySelector("span.login-button a"):u=document.querySelector("a.upload"),t&&(u=f.querySelector("media-button[data-mediatype=images] a")),u&&u.focus()}e.preventDefault(),e.stopPropagation()}function le(e){(e.key==="Escape"||e.keyCode===27)&&(T=!0,_=!0,S(),g(!0,!0),L())}function ce(){var t,o,n;let e=JSON.parse((o=(t=document.querySelector(".js_nav_tweaks"))==null?void 0:t.value)!=null?o:!1);e&&(e.hideSearch&&(m.querySelector("nav-search").classList.add("hidden"),m.querySelector("button.search-trigger").classList.add("hidden")),e.uploadURL&&((n=m.querySelector("a.upload"))==null||n.setAttribute("href",e.uploadURL)))}function H(e){let t=c.querySelector("ul"),o=document.createElement("li");for(o.classList="style-scope user-menu divider",t.append(o);e.length;){let n=e.shift();o=document.createElement("li"),o.classList="style-scope user-menu",o.innerHTML=n.url?`<a href="${n.url}" class="style-scope user-menu"
            data-event-click-tracking="TopNav|${n.analyticsEvent}" tabindex="-1">${n.title}</a>`:`<span class="style-scope user-menu info-item">${n.title}</span`,t.append(o)}}function ue(){var a,s;let e=JSON.parse((s=(a=document.querySelector(".js_user_menu_links"))==null?void 0:a.value)!=null?s:!1);if(!e)return;let{identifier:t,uploader:o,biblio:n}=e;H([{title:"ADMINS:"},{title:"item:"},{url:`/editxml/${t}`,title:"edit xml",analyticsEvent:"AdminUserEditXML"},{url:`/edit.php?redir=1&identifier=${t}`,title:"edit files",analyticsEvent:"AdminUserEditFiles"},{url:`/download/${t}/`,title:"download",analyticsEvent:"AdminUserDownload"},{url:`/metadata/${t}/`,title:"metadata",analyticsEvent:"AdminUserMetadata"},{url:`https://catalogd.archive.org/history/${t}`,title:"history",analyticsEvent:"AdminUserHistory"},{url:`/manage/${t}`,title:"manage",analyticsEvent:"AdminUserManager"},{url:`/manage/${t}#make_dark`,title:"curate",analyticsEvent:"AdminUserCurate"},{url:`/manage/${t}#modify_xml`,title:"modify xml",analyticsEvent:"AdminUserModifyXML"},{url:`/services/flags/admin.php?identifier=${t}`,title:"manage flags",analyticsEvent:"AdminUserManageFlags"}]),n&&H([{url:`${n}&ignored=${t}`,title:"biblio",analyticsEvent:"AdminUserBiblio"},{url:`/bookview.php?mode=debug&identifier=${t}`,title:"bookview",analyticsEvent:"AdminUserBookView"},{url:`/download/${t}/format=Single Page Processed JP2 ZIP`,title:"jp2 zip",analyticsEvent:"AdminUserJP2Zip"}]),o&&H([{title:"uploader:"},{title:o},{url:`https://catalogd.archive.org/control/useradmin.php?email=${o}`,title:"user admin",analyticsEvent:"AdminUserUserAdmin"},{url:`https://catalogd.archive.org/control/setadmin.php?user=${o}&ignore=${t}`,title:"user privs",analyticsEvent:"AdminUserUserPrivs"}])}let O="icon-hamburger svg:nth-child(1)",I="icon-hamburger-x";function V(){try{let e=document.getElementsByTagName("icon-hamburger")[0];document.getElementById(I)||(document.querySelector(O).style.display="none",e.innerHTML=e.innerHTML+'<svg id="'+I+'" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" aria-labelledby="closeTitleID closeDescID" style="fill:white;width:4rem;height:4rem;"><title id="closeTitleID">Close icon</title><desc id="closeDescID">A line drawing of an X</desc><path d="m29.1923882 10.8076118c.5857864.5857865.5857864 1.535534 0 2.1213204l-7.0711162 7.0703398 7.0711162 7.0717958c.5857864.5857864.5857864 1.5355339 0 2.1213204-.5857865.5857864-1.535534.5857864-2.1213204 0l-7.0717958-7.0711162-7.0703398 7.0711162c-.5857864.5857864-1.5355339.5857864-2.1213204 0-.5857864-.5857865-.5857864-1.535534 0-2.1213204l7.0706602-7.0717958-7.0706602-7.0703398c-.5857864-.5857864-.5857864-1.5355339 0-2.1213204.5857865-.5857864 1.535534-.5857864 2.1213204 0l7.0703398 7.0706602 7.0717958-7.0706602c.5857864-.5857864 1.5355339-.5857864 2.1213204 0z" class="fill-color" fill-rule="evenodd"></path></svg>')}catch(e){console.error({error:e})}}function z(){var e;try{document.querySelector(O).style.display="",(e=document.getElementById(I))==null||e.remove()}catch(t){console.error({error:t})}}function de(){P(!0),l.querySelector(".advanced-search").setAttribute("tabindex","-1")}te(),ue(),ce(),de(),Z("IA topnav has loaded.")});})();
// @license-end
//# sourceMappingURL=ia-topnav.min.js.map
